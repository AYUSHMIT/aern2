<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
    Module      :  AERN2.WithGlobalParam.Branching
    Description :  branching operations
    Copyright   :  (c) Michal Konecny, Eike Neumann
    License     :  BSD3

    Maintainer  :  mikkonecny@gmail.com
    Stability   :  experimental
    Portability :  portable

    Branching operations for WithGlobalParam objects.
-}</span><span>
</span><a name="line-13"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">WithGlobalParam</span><span class="hs-operator">.</span><span class="hs-identifier">Branching</span><span>
</span><a name="line-14"></a><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>  </span><span class="hs-comment">-- pickNonZeroWGParamA</span><span>
</span><a name="line-16"></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MixedTypesNumPrelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- import qualified Prelude as P</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.QA.Protocol.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">QA</span><span class="hs-operator">.</span><span class="hs-identifier">Protocol</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.WithGlobalParam.Type.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">WithGlobalParam</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- import AERN2.WithGlobalParam.Comparison ()</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">-- {- non-zero picking -}</span><span>
</span><a name="line-29"></a><span class="hs-comment">--</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- {-|</span><span>
</span><a name="line-31"></a><span class="hs-comment">--   Given a list @[(a1,b1),(a2,b2),...]@ and assuming that</span><span>
</span><a name="line-32"></a><span class="hs-comment">--   at least one of @a1,a2,...@ is non-zero, pick one of them</span><span>
</span><a name="line-33"></a><span class="hs-comment">--   and return the corresponding pair @(ai,bi)@.</span><span>
</span><a name="line-34"></a><span class="hs-comment">--</span><span>
</span><a name="line-35"></a><span class="hs-comment">--   If none of @a1,a2,...@ is zero, either throw an exception</span><span>
</span><a name="line-36"></a><span class="hs-comment">--   or loop forever.</span><span>
</span><a name="line-37"></a><span class="hs-comment">--  -}</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- pickNonZeroWGParamA ::</span><span>
</span><a name="line-39"></a><span class="hs-comment">--   (QAArrow to, CanPickNonZero a)</span><span>
</span><a name="line-40"></a><span class="hs-comment">--   =&gt;</span><span>
</span><a name="line-41"></a><span class="hs-comment">--   Maybe (QAId to) -&gt;</span><span>
</span><a name="line-42"></a><span class="hs-comment">--   [(WithGlobalParamA to prm a, s)] `to` Maybe (WithGlobalParamA to prm a, s)</span><span>
</span><a name="line-43"></a><span class="hs-comment">-- pickNonZeroWGParamA src =</span><span>
</span><a name="line-44"></a><span class="hs-comment">--     proc seqsAndS -&gt; do</span><span>
</span><a name="line-45"></a><span class="hs-comment">--       balls &lt;- wgprmQueryA src -&lt; (map fst seqsAndS, prm)</span><span>
</span><a name="line-46"></a><span class="hs-comment">--       let maybeNonZero = pickNonZero $ zip balls seqsAndS</span><span>
</span><a name="line-47"></a><span class="hs-comment">--       case maybeNonZero of</span><span>
</span><a name="line-48"></a><span class="hs-comment">--         Just (_,result) -&gt; returnA -&lt; Just result</span><span>
</span><a name="line-49"></a><span class="hs-comment">--         _ -&gt; startFromAccuracy (ac + 1) -&lt; seqsAndS</span><span>
</span><a name="line-50"></a><span class="hs-comment">--</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- instance (CanPickNonZero a) =&gt; CanPickNonZero (WithGlobalParam prm a) where</span><span>
</span><a name="line-52"></a><span class="hs-comment">--   pickNonZero = pickNonZeroWGParamA Nothing</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">{-| lifted if-then-else -}</span><span>
</span><a name="line-55"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">(</span><a href="AERN2.QA.Protocol.html#QAArrow"><span class="hs-identifier hs-type">QAArrow</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HasIfThenElse</span><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#SuitableForWGParam"><span class="hs-identifier hs-type">SuitableForWGParam</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#SuitableForWGParam"><span class="hs-identifier hs-type">SuitableForWGParam</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#SuitableForWGParam"><span class="hs-identifier hs-type">SuitableForWGParam</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfThenElseType</span><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>  </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-identifier hs-type">HasIfThenElse</span><span> </span><span class="hs-special">(</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">IfThenElseType</span><span> </span><span class="hs-special">(</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfThenElseType</span><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>  </span><a name="local-8214565720323804147"><span class="hs-identifier">ifThenElse</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679150223"><a href="#local-6989586621679150223"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">::</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679150224"><a href="#local-6989586621679150224"><span class="hs-identifier">e1</span></a></a><span class="hs-glyph">::</span><a href="AERN2.WithGlobalParam.Type.html#WithGlobalParamA"><span class="hs-identifier hs-type">WithGlobalParamA</span></a><span> </span><a href="#local-6989586621679150219"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679150225"><a href="#local-6989586621679150225"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-63"></a><span>    </span><a href="AERN2.WithGlobalParam.Type.html#newWGParam"><span class="hs-identifier hs-var">newWGParam</span></a><span> </span><a href="#local-6989586621679150227"><span class="hs-identifier hs-var">samplePrm</span></a><span> </span><a href="#local-6989586621679150226"><span class="hs-identifier hs-var">sampleT</span></a><span> </span><span class="hs-string">&quot;pif&quot;</span><span> </span><span class="hs-special">[</span><a href="AERN2.QA.Protocol.html#AnyProtocolQA"><span class="hs-identifier hs-var">AnyProtocolQA</span></a><span> </span><a href="#local-6989586621679150223"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.QA.Protocol.html#AnyProtocolQA"><span class="hs-identifier hs-var">AnyProtocolQA</span></a><span> </span><a href="#local-6989586621679150224"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.QA.Protocol.html#AnyProtocolQA"><span class="hs-identifier hs-var">AnyProtocolQA</span></a><span> </span><a href="#local-6989586621679150225"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679150228"><span class="hs-identifier hs-var">makeQ</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-65"></a><span>    </span><a name="local-6989586621679150226"><a href="#local-6989586621679150226"><span class="hs-identifier">sampleT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfThenElseType</span><span> </span><a href="#local-6989586621679150220"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679150221"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679150227"><a href="#local-6989586621679150227"><span class="hs-identifier">samplePrm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679150222"><span class="hs-identifier hs-type">prm</span></a><span>
</span><a name="line-67"></a><span>    </span><a name="local-6989586621679150228"><a href="#local-6989586621679150228"><span class="hs-identifier">makeQ</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679150229"><a href="#local-6989586621679150229"><span class="hs-identifier">me</span></a></a><span class="hs-special">,</span><a name="local-6989586621679150230"><a href="#local-6989586621679150230"><span class="hs-identifier">_src</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-68"></a><span>      </span><span class="hs-identifier">proc</span><span> </span><a name="local-6989586621679150231"><a href="#local-6989586621679150231"><span class="hs-identifier">prm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-keyword">do</span><span>
</span><a name="line-70"></a><span>        </span><a name="local-6989586621679150232"><a href="#local-6989586621679150232"><span class="hs-identifier">bP</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#wgprmQueryA"><span class="hs-identifier hs-var">wgprmQueryA</span></a><span> </span><a href="#local-6989586621679150229"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679150223"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679150231"><span class="hs-identifier hs-var">prm</span></a><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>        </span><a name="local-6989586621679150233"><a href="#local-6989586621679150233"><span class="hs-identifier">e1P</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#wgprmQueryA"><span class="hs-identifier hs-var">wgprmQueryA</span></a><span> </span><a href="#local-6989586621679150229"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679150224"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679150231"><span class="hs-identifier hs-var">prm</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>        </span><a name="local-6989586621679150234"><a href="#local-6989586621679150234"><span class="hs-identifier">e2P</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="AERN2.WithGlobalParam.Type.html#wgprmQueryA"><span class="hs-identifier hs-var">wgprmQueryA</span></a><span> </span><a href="#local-6989586621679150229"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679150225"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679150231"><span class="hs-identifier hs-var">prm</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>        </span><span class="hs-identifier hs-var">returnA</span><span> </span><span class="hs-operator">-&lt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679150232"><span class="hs-identifier hs-var">bP</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679150233"><span class="hs-identifier hs-var">e1P</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679150234"><span class="hs-identifier hs-var">e2P</span></a><span>
</span><a name="line-74"></a></pre></body></html>