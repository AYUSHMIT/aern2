<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- #define DEBUG</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">Poly</span><span class="hs-operator">.</span><span class="hs-identifier">Power</span><span class="hs-operator">.</span><span class="hs-identifier">RootsIntVector</span><span>
</span><a name="line-4"></a><span class="hs-special">(</span><span>
</span><a name="line-5"></a><span>    </span><a href="AERN2.Poly.Power.RootsIntVector.html#initialBernsteinCoefs"><span class="hs-identifier hs-var">initialBernsteinCoefs</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#bernsteinCoefs"><span class="hs-identifier hs-var">bernsteinCoefs</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#signVars"><span class="hs-identifier hs-var">signVars</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#reflect"><span class="hs-identifier hs-var">reflect</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#contract"><span class="hs-identifier hs-var">contract</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#translate"><span class="hs-identifier hs-var">translate</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#transform"><span class="hs-identifier hs-var">transform</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#findRootsWithAccuracy"><span class="hs-identifier hs-var">findRootsWithAccuracy</span></a><span>
</span><a name="line-13"></a><span class="hs-comment">--  , findRoots</span><span>
</span><a name="line-14"></a><span>  </span><span class="hs-comment">--, reduce</span><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span>
</span><a name="line-16"></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Debug</span><span class="hs-operator">.</span><span class="hs-identifier">Trace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">trace</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-cpp">#define maybeTrace trace</span><span>
</span><a name="line-22"></a><span class="hs-cpp">#define maybeTraceIO putStrLn</span><span>
</span><a name="line-23"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-24"></a><span class="hs-cpp">#define maybeTrace (\ (_ :: String) t -&gt; t)</span><span>
</span><a name="line-25"></a><span class="hs-cpp">#define maybeTraceIO (\ (_ :: String) -&gt; return ())</span><span>
</span><a name="line-26"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MixedTypesNumPrelude</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.Interval.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">Interval</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">MP</span><span class="hs-operator">.</span><span class="hs-identifier">Ball</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">iterateUntilAccurate</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- import AERN2.MP.Dyadic</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ratio</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.Poly.Power.Type.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">Poly</span><span class="hs-operator">.</span><span class="hs-identifier">Power</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.Poly.Basics.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">Poly</span><span class="hs-operator">.</span><span class="hs-identifier">Basics</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Basics.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="AERN2.Poly.Power.Eval.html"><span class="hs-identifier">AERN2</span><span class="hs-operator">.</span><span class="hs-identifier">Poly</span><span class="hs-operator">.</span><span class="hs-identifier">Power</span><span class="hs-operator">.</span><span class="hs-identifier">Eval</span></a><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">--import AERN2.Poly.Power.SignedSubresultant</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">type</span><span> </span><a name="Terms"><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier">Terms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ErrorBound</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">{-instance (HasAccuracy c) =&gt; HasAccuracy (Terms c) where
  getAccuracy ts = Map.foldl' min (Exact) $ Map.map getAccuracy ts-}</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-identifier">ts_deg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-53"></a><a name="ts_deg"><a href="AERN2.Poly.Power.RootsIntVector.html#ts_deg"><span class="hs-identifier">ts_deg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679439508"><a href="#local-6989586621679439508"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679439508"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">{-signVars :: Terms -&gt; Maybe Integer
signVars ts@(e, c, cfs) =
  aux 0 0 0
  where
  ce = c * rational e
  eZero = ce == 0
  sgn0 x
   | x == 0 &amp;&amp; eZero  = Just 0
   | x &gt;  ce          = Just 1
   | x &lt; -ce          = Just (-1)
   | otherwise        = Nothing
  sgn x
    | x == 0    = 0
    | x &gt;  0    = 1
    | otherwise = -1
  dts = ts_deg ts
  aux vrs sg d =
    if d &gt; dts then
      Just vrs
    else if d == 0 then
      case sgn0 (cfs ! int d) of
        Nothing   -&gt; Nothing
        Just sgnx -&gt;
          if sgnx == 0 || sg == 0 || sgnx == sg then
            aux vrs (if sgnx /= 0 then sgnx else sg) 1
          else
            aux (vrs + 1) sgnx 1
    else
      let
        sgnx = sgn (cfs ! int d)
      in
      if sgnx == 0 || sg == 0 || sgnx == sg then
        aux vrs (if sgnx /= 0 then sgnx else sg) (d + 1)
      else
        aux (vrs + 1) sgnx (d + 1)-}</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier">signVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-92"></a><a name="signVars"><a href="AERN2.Poly.Power.RootsIntVector.html#signVars"><span class="hs-identifier">signVars</span></a></a><span> </span><a name="local-6989586621679439509"><a href="#local-6989586621679439509"><span class="hs-identifier">ts</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679439510"><a href="#local-6989586621679439510"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439511"><a href="#local-6989586621679439511"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439512"><a href="#local-6989586621679439512"><span class="hs-identifier">cfs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-93"></a><span>  </span><a href="#local-6989586621679439516"><span class="hs-identifier hs-var">aux</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#ts_deg"><span class="hs-identifier hs-var">ts_deg</span></a><span> </span><a href="#local-6989586621679439509"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-95"></a><span>  </span><a name="local-6989586621679439513"><a href="#local-6989586621679439513"><span class="hs-identifier">ce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439511"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">rational</span><span> </span><a href="#local-6989586621679439510"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-96"></a><span>  </span><a name="local-6989586621679439514"><a href="#local-6989586621679439514"><span class="hs-identifier">eZero</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439513"><span class="hs-identifier hs-var">ce</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-97"></a><span>  </span><a name="local-6989586621679439515"><a href="#local-6989586621679439515"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621679439517"><a href="#local-6989586621679439517"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-98"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679439517"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679439514"><span class="hs-identifier hs-var">eZero</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-99"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679439517"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>  </span><a href="#local-6989586621679439513"><span class="hs-identifier hs-var">ce</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-100"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679439517"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-glyph">-</span><a href="#local-6989586621679439513"><span class="hs-identifier hs-var">ce</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-102"></a><span>  </span><a name="local-6989586621679439516"><a href="#local-6989586621679439516"><span class="hs-identifier">aux</span></a></a><span> </span><a name="local-6989586621679439518"><a href="#local-6989586621679439518"><span class="hs-identifier">vrs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679439518"><span class="hs-identifier hs-var">vrs</span></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-identifier">aux</span><span> </span><a name="local-6989586621679439519"><a href="#local-6989586621679439519"><span class="hs-identifier">vrs</span></a></a><span> </span><a name="local-6989586621679439520"><a href="#local-6989586621679439520"><span class="hs-identifier">sg</span></a></a><span> </span><a name="local-6989586621679439521"><a href="#local-6989586621679439521"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679439515"><span class="hs-identifier hs-var">sgn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439512"><span class="hs-identifier hs-var">cfs</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679439521"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-105"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-106"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679439522"><a href="#local-6989586621679439522"><span class="hs-identifier">sgnx</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-107"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439522"><span class="hs-identifier hs-var">sgnx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679439520"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679439522"><span class="hs-identifier hs-var">sgnx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679439520"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-108"></a><span>          </span><a href="#local-6989586621679439516"><span class="hs-identifier hs-var">aux</span></a><span> </span><a href="#local-6989586621679439519"><span class="hs-identifier hs-var">vrs</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439522"><span class="hs-identifier hs-var">sgnx</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679439522"><span class="hs-identifier hs-var">sgnx</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679439520"><span class="hs-identifier hs-var">sg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439521"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>        </span><span class="hs-keyword">else</span><span>
</span><a name="line-110"></a><span>          </span><a href="#local-6989586621679439516"><span class="hs-identifier hs-var">aux</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439519"><span class="hs-identifier hs-var">vrs</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439522"><span class="hs-identifier hs-var">sgnx</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439521"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- Input: l,m and Polynomial P.</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- Output: some positive integer constant c and coefficients of c*P in Bernstein basis on [l,r].</span><span>
</span><a name="line-114"></a><span class="hs-identifier">initialBernsteinCoefs</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ErrorBound</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span>
</span><a name="line-115"></a><a name="initialBernsteinCoefs"><a href="AERN2.Poly.Power.RootsIntVector.html#initialBernsteinCoefs"><span class="hs-identifier">initialBernsteinCoefs</span></a></a><span> </span><a name="local-6989586621679439523"><a href="#local-6989586621679439523"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679439524"><a href="#local-6989586621679439524"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679439525"><a href="#local-6989586621679439525"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679439526"><a href="#local-6989586621679439526"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-116"></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679439524"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439537"><span class="hs-identifier hs-var">lambda</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439538"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>  </span><a name="local-6989586621679439527"><a href="#local-6989586621679439527"><span class="hs-identifier">lI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439525"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1.0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-119"></a><span>  </span><a name="local-6989586621679439528"><a href="#local-6989586621679439528"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.Type.html#degree"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679439523"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-120"></a><span>  </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><a name="local-6989586621679439529"><a href="#local-6989586621679439529"><span class="hs-identifier">csI</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#transform"><span class="hs-identifier hs-var">transform</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621679439527"><span class="hs-identifier hs-var">lI</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439523"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-121"></a><span>  </span><a name="local-6989586621679439530"><a href="#local-6989586621679439530"><span class="hs-identifier">binoms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439539"><a href="#local-6989586621679439539"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#binom"><span class="hs-identifier hs-var">binom</span></a><span> </span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439539"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>  </span><a name="local-6989586621679439531"><a href="#local-6989586621679439531"><span class="hs-identifier">csVect</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439540"><a href="#local-6989586621679439540"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Basics.html#terms_lookupCoeff"><span class="hs-identifier hs-var">terms_lookupCoeff</span></a><span> </span><a href="#local-6989586621679439529"><span class="hs-identifier hs-var">csI</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621679439540"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>  </span><a name="local-6989586621679439532"><a href="#local-6989586621679439532"><span class="hs-identifier">bsFrac</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span>
</span><a name="line-125"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439541"><a href="#local-6989586621679439541"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439531"><span class="hs-identifier hs-var">csVect</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679439541"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/!</span><span> </span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439530"><span class="hs-identifier hs-var">binoms</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679439541"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>  </span><a name="local-6989586621679439533"><a href="#local-6989586621679439533"><span class="hs-identifier">lambdaI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-identifier hs-var">lcm</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">denominator</span><span> </span><a href="#local-6989586621679439532"><span class="hs-identifier hs-var">bsFrac</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>  </span><a name="local-6989586621679439534"><a href="#local-6989586621679439534"><span class="hs-identifier">bsI</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439542"><a href="#local-6989586621679439542"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439533"><span class="hs-identifier hs-var">lambdaI</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439532"><span class="hs-identifier hs-var">bsFrac</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439528"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439542"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679439535"><a href="#local-6989586621679439535"><span class="hs-identifier">lambdaL</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439536"><a href="#local-6989586621679439536"><span class="hs-identifier">bsL</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#bernsteinCoefs"><span class="hs-identifier hs-var">bernsteinCoefs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1.0</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rational</span><span> </span><a href="#local-6989586621679439527"><span class="hs-identifier hs-var">lI</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439525"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439524"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439533"><span class="hs-identifier hs-var">lambdaI</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439534"><span class="hs-identifier hs-var">bsI</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679439537"><a href="#local-6989586621679439537"><span class="hs-identifier">lambda</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439538"><a href="#local-6989586621679439538"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#bernsteinCoefs"><span class="hs-identifier hs-var">bernsteinCoefs</span></a><span> </span><a href="#local-6989586621679439525"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rational</span><span> </span><a href="#local-6989586621679439527"><span class="hs-identifier hs-var">lI</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439526"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439524"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439535"><span class="hs-identifier hs-var">lambdaL</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439536"><span class="hs-identifier hs-var">bsL</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- Input: (l,r,m,c, List of coefficients of c*P in Bernstein basis on [l,r])</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- Output: c' and Lists of coefficients of c'*P in Bernstein basis on [l,m] and [m,r].</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- Note that m does not have to lie between l and r.</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- This is Algorithm 10.3 [Special Bernstein Coefficients] in</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- Basu, Pollack, Roy: Algorithms in Real Algebraic Geometry</span><span>
</span><a name="line-140"></a><span class="hs-identifier">bernsteinCoefs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="bernsteinCoefs"><a href="AERN2.Poly.Power.RootsIntVector.html#bernsteinCoefs"><span class="hs-identifier">bernsteinCoefs</span></a></a><span> </span><a name="local-6989586621679439543"><a href="#local-6989586621679439543"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679439544"><a href="#local-6989586621679439544"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679439545"><a href="#local-6989586621679439545"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679439546"><a href="#local-6989586621679439546"><span class="hs-identifier">ts</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679439547"><a href="#local-6989586621679439547"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439548"><a href="#local-6989586621679439548"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439549"><a href="#local-6989586621679439549"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679439547"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439550"><span class="hs-identifier hs-var">c'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439559"><span class="hs-identifier hs-var">bsL</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439547"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439550"><span class="hs-identifier hs-var">c'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439560"><span class="hs-identifier hs-var">bsR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>  </span><a name="local-6989586621679439550"><a href="#local-6989586621679439550"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439555"><span class="hs-identifier hs-var">diff</span></a><span class="hs-operator hs-var">^!</span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439548"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-145"></a><span>  </span><a name="local-6989586621679439551"><a href="#local-6989586621679439551"><span class="hs-identifier">d</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span> </span><span class="hs-identifier hs-var">lcm</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">denominator</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679439543"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679439544"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621679439545"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span>
</span><a name="line-146"></a><span>  </span><a name="local-6989586621679439552"><a href="#local-6989586621679439552"><span class="hs-identifier">l'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439551"><span class="hs-identifier hs-var">d</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439543"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-147"></a><span>  </span><a name="local-6989586621679439553"><a href="#local-6989586621679439553"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439551"><span class="hs-identifier hs-var">d</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439545"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-148"></a><span>  </span><a name="local-6989586621679439554"><a href="#local-6989586621679439554"><span class="hs-identifier">r'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">numerator</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439551"><span class="hs-identifier hs-var">d</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439544"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-149"></a><span>  </span><a name="local-6989586621679439555"><a href="#local-6989586621679439555"><span class="hs-identifier">diff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439554"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439552"><span class="hs-identifier hs-var">l'</span></a><span>
</span><a name="line-150"></a><span>  </span><a name="local-6989586621679439556"><a href="#local-6989586621679439556"><span class="hs-identifier">p</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#ts_deg"><span class="hs-identifier hs-var">ts_deg</span></a><span> </span><a href="#local-6989586621679439546"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-151"></a><span>  </span><a name="local-6989586621679439557"><a href="#local-6989586621679439557"><span class="hs-identifier">bi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439558"><span class="hs-identifier hs-var">biAcc</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679439549"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>  </span><a name="local-6989586621679439558"><a href="#local-6989586621679439558"><span class="hs-identifier">biAcc</span></a></a><span> </span><a name="local-6989586621679439561"><a href="#local-6989586621679439561"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679439562"><a href="#local-6989586621679439562"><span class="hs-identifier">biM</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439561"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-154"></a><span>      </span><a href="#local-6989586621679439562"><span class="hs-identifier hs-var">biM</span></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-156"></a><span>      </span><a href="#local-6989586621679439558"><span class="hs-identifier hs-var">biAcc</span></a><span>
</span><a name="line-157"></a><span>      </span><span class="hs-special">(</span><a href="#local-6989586621679439561"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><a href="#local-6989586621679439561"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-159"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span>
</span><a name="line-160"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439561"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439563"><a href="#local-6989586621679439563"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-162"></a><span>            </span><span class="hs-keyword">let</span><span>
</span><a name="line-163"></a><span>              </span><a name="local-6989586621679439564"><a href="#local-6989586621679439564"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439561"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439562"><span class="hs-identifier hs-var">biM</span></a><span>
</span><a name="line-164"></a><span>            </span><span class="hs-keyword">in</span><span>
</span><a name="line-165"></a><span>            </span><span class="hs-special">(</span><a href="#local-6989586621679439554"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439553"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><a href="#local-6989586621679439564"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679439563"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439553"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439552"><span class="hs-identifier hs-var">l'</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><a href="#local-6989586621679439564"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439563"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>            </span><a href="#local-6989586621679439562"><span class="hs-identifier hs-var">biM</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>  </span><a name="local-6989586621679439559"><a href="#local-6989586621679439559"><span class="hs-identifier">bsL</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span>
</span><a name="line-169"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439565"><a href="#local-6989586621679439565"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439555"><span class="hs-identifier hs-var">diff</span></a><span class="hs-operator hs-var">^!</span><span class="hs-special">(</span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439565"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621679439565"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439557"><span class="hs-identifier hs-var">bi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>  </span><a name="local-6989586621679439560"><a href="#local-6989586621679439560"><span class="hs-identifier">bsR</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span>
</span><a name="line-173"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439566"><a href="#local-6989586621679439566"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439555"><span class="hs-identifier hs-var">diff</span></a><span class="hs-operator hs-var">^!</span><a href="#local-6989586621679439566"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439556"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439566"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439557"><span class="hs-identifier hs-var">bi</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679439566"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-identifier">reflect</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><a href="#local-6989586621679439507"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><a href="#local-6989586621679439507"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-177"></a><a name="reflect"><a href="AERN2.Poly.Power.RootsIntVector.html#reflect"><span class="hs-identifier">reflect</span></a></a><span> </span><a name="local-6989586621679439567"><a href="#local-6989586621679439567"><span class="hs-identifier">poly</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><a name="local-6989586621679439568"><a href="#local-6989586621679439568"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-178"></a><span>  </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><a href="#local-6989586621679439569"><span class="hs-identifier hs-var">ts'</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-180"></a><span>  </span><a name="local-6989586621679439569"><a href="#local-6989586621679439569"><span class="hs-identifier">ts'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapKeys</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439571"><a href="#local-6989586621679439571"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439570"><span class="hs-identifier hs-var">deg</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439571"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439568"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-181"></a><span>  </span><a name="local-6989586621679439570"><a href="#local-6989586621679439570"><span class="hs-identifier">deg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.Type.html#degree"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679439567"><span class="hs-identifier hs-var">poly</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">translate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-184"></a><a name="translate"><a href="AERN2.Poly.Power.RootsIntVector.html#translate"><span class="hs-identifier">translate</span></a></a><span> </span><a name="local-6989586621679439572"><a href="#local-6989586621679439572"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679439573"><a href="#local-6989586621679439573"><span class="hs-identifier">poly</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><a name="local-6989586621679439574"><a href="#local-6989586621679439574"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-185"></a><span>    </span><a href="#local-6989586621679439575"><span class="hs-identifier hs-var">translateAcc</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#degree"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679439573"><span class="hs-identifier hs-var">poly</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-186"></a><span>      </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><a href="AERN2.Poly.Basics.html#terms_lookupCoeff"><span class="hs-identifier hs-var">terms_lookupCoeff</span></a><span> </span><a href="#local-6989586621679439574"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#degree"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679439573"><span class="hs-identifier hs-var">poly</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621679439575"><a href="#local-6989586621679439575"><span class="hs-identifier">translateAcc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679439576"><a href="#local-6989586621679439576"><span class="hs-identifier">poly'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439576"><span class="hs-identifier hs-var">poly'</span></a><span>
</span><a name="line-189"></a><span>    </span><span class="hs-identifier">translateAcc</span><span> </span><a name="local-6989586621679439577"><a href="#local-6989586621679439577"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679439578"><a href="#local-6989586621679439578"><span class="hs-identifier">poly'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-190"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-191"></a><span>        </span><a name="local-6989586621679439579"><a href="#local-6989586621679439579"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Basics.html#terms_lookupCoeff"><span class="hs-identifier hs-var">terms_lookupCoeff</span></a><span> </span><a href="#local-6989586621679439574"><span class="hs-identifier hs-var">ts</span></a><span> </span><a href="#local-6989586621679439577"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-192"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-193"></a><span>        </span><a href="#local-6989586621679439575"><span class="hs-identifier hs-var">translateAcc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439577"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439579"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#shiftRight"><span class="hs-identifier hs-var">shiftRight</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679439578"><span class="hs-identifier hs-var">poly'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439572"><span class="hs-identifier hs-var">t</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439578"><span class="hs-identifier hs-var">poly'</span></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">contract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CanMulSameType</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CanPow</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PowTypeNoCN</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CanEnsureCN</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><a href="#local-6989586621679439506"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-197"></a><a name="contract"><a href="AERN2.Poly.Power.RootsIntVector.html#contract"><span class="hs-identifier">contract</span></a></a><span> </span><a name="local-6989586621679439580"><a href="#local-6989586621679439580"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><a name="local-6989586621679439581"><a href="#local-6989586621679439581"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-198"></a><span>  </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-var">PowPoly</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="AERN2.Poly.Basics.html#Poly"><span class="hs-identifier hs-var">Poly</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679439582"><a href="#local-6989586621679439582"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679439583"><a href="#local-6989586621679439583"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439583"><span class="hs-identifier hs-var">c</span></a><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><a href="#local-6989586621679439580"><span class="hs-identifier hs-var">l</span></a><span class="hs-operator hs-var">^!</span><a href="#local-6989586621679439582"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439581"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">transform</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-201"></a><a name="transform"><a href="AERN2.Poly.Power.RootsIntVector.html#transform"><span class="hs-identifier">transform</span></a></a><span> </span><a name="local-6989586621679439584"><a href="#local-6989586621679439584"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679439585"><a href="#local-6989586621679439585"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-202"></a><span>  </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#translate"><span class="hs-identifier hs-var">translate</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#reflect"><span class="hs-identifier hs-var">reflect</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#contract"><span class="hs-identifier hs-var">contract</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439585"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439584"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#translate"><span class="hs-identifier hs-var">translate</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621679439584"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">{- root finding algorithm: -}</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-keyword">data</span><span> </span><a name="HasRoot"><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier">HasRoot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>  </span><a name="Yes"><a href="AERN2.Poly.Power.RootsIntVector.html#Yes"><span class="hs-identifier">Yes</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="DontKnow"><a href="AERN2.Poly.Power.RootsIntVector.html#DontKnow"><span class="hs-identifier">DontKnow</span></a></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Prelude</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">HasEqAsymmetric</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier hs-type">HasRoot</span></a><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier hs-type">HasRoot</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">EqCompareType</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier hs-type">HasRoot</span></a><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier hs-type">HasRoot</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-comment">{-
  Upper bound on the roots of poly in the open interval (l,r),
  i.e. an ordered list of intervals whose union
  contains all roots. There is no guarantee that every interval in the
  list contains a root.
-}</span><span>
</span><a name="line-222"></a><span class="hs-identifier">findRootsWithAccuracy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="AERN2.Poly.Power.Type.html#PowPoly"><span class="hs-identifier hs-type">PowPoly</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Accuracy</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><a name="findRootsWithAccuracy"><a href="AERN2.Poly.Power.RootsIntVector.html#findRootsWithAccuracy"><span class="hs-identifier">findRootsWithAccuracy</span></a></a><span> </span><a name="local-6989586621679439586"><a href="#local-6989586621679439586"><span class="hs-identifier">poly</span></a></a><span> </span><a name="local-6989586621679439587"><a href="#local-6989586621679439587"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679439588"><a href="#local-6989586621679439588"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679439589"><a href="#local-6989586621679439589"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-224"></a><span>  </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439588"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679439589"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439590"><span class="hs-identifier hs-var">bsI</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#DontKnow"><span class="hs-identifier hs-var">DontKnow</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-226"></a><span>  </span><a name="local-6989586621679439590"><a href="#local-6989586621679439590"><span class="hs-identifier">bsI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#initialBernsteinCoefs"><span class="hs-identifier hs-var">initialBernsteinCoefs</span></a><span> </span><a href="#local-6989586621679439586"><span class="hs-identifier hs-var">poly</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">errorBound</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679439588"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679439589"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-comment">-- TODO: allow non-zero error?</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-identifier">splitUntilAccurate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Terms"><span class="hs-identifier hs-type">Terms</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#HasRoot"><span class="hs-identifier hs-type">HasRoot</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">]</span><span>
</span><a name="line-228"></a><span>  </span><a name="local-6989586621679439591"><a href="#local-6989586621679439591"><span class="hs-identifier">splitUntilAccurate</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679439593"><a href="#local-6989586621679439593"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a name="local-6989586621679439594"><a href="#local-6989586621679439594"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679439595"><a href="#local-6989586621679439595"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679439596"><a href="#local-6989586621679439596"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439597"><a href="#local-6989586621679439597"><span class="hs-identifier">hasRoot</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439592"><span class="hs-identifier hs-var">intervalAccurate</span></a><span> </span><a href="#local-6989586621679439593"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-230"></a><span>      </span><span class="hs-special">[</span><a href="#local-6989586621679439593"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-232"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679439597"><span class="hs-identifier hs-var">hasRoot</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-233"></a><span>        </span><a href="AERN2.Poly.Power.RootsIntVector.html#Yes"><span class="hs-identifier hs-var">Yes</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-234"></a><span>          </span><span class="hs-keyword">let</span><span>
</span><a name="line-235"></a><span>          </span><a name="local-6989586621679439598"><a href="#local-6989586621679439598"><span class="hs-identifier">m</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679439595"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">/!</span><span class="hs-number">2</span><span>
</span><a name="line-236"></a><span>          </span><a name="local-6989586621679439599"><a href="#local-6989586621679439599"><span class="hs-identifier">fa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.Eval.html#evalDirect"><span class="hs-identifier hs-var">evalDirect</span></a><span> </span><a href="#local-6989586621679439586"><span class="hs-identifier hs-var">poly</span></a><span> </span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-237"></a><span>          </span><a name="local-6989586621679439600"><a href="#local-6989586621679439600"><span class="hs-identifier">fm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.Eval.html#evalDirect"><span class="hs-identifier hs-var">evalDirect</span></a><span> </span><a href="#local-6989586621679439586"><span class="hs-identifier hs-var">poly</span></a><span> </span><a href="#local-6989586621679439598"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-238"></a><span>          </span><span class="hs-keyword">in</span><span>
</span><a name="line-239"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679439599"><span class="hs-identifier hs-var">fa</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679439600"><span class="hs-identifier hs-var">fm</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-240"></a><span>            </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679439598"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439596"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Yes"><span class="hs-identifier hs-var">Yes</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>          </span><span class="hs-keyword">else</span><span>
</span><a name="line-242"></a><span>            </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439598"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679439595"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439596"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Yes"><span class="hs-identifier hs-var">Yes</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>        </span><a href="AERN2.Poly.Power.RootsIntVector.html#DontKnow"><span class="hs-identifier hs-var">DontKnow</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-244"></a><span>          </span><span class="hs-keyword">let</span><span>
</span><a name="line-245"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679439601"><a href="#local-6989586621679439601"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#signVars"><span class="hs-identifier hs-var">signVars</span></a><span> </span><a href="#local-6989586621679439596"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-246"></a><span>            </span><a name="local-6989586621679439602"><a href="#local-6989586621679439602"><span class="hs-identifier">m</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679439595"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-operator hs-var">/!</span><span class="hs-number">2</span><span>
</span><a name="line-247"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679439603"><a href="#local-6989586621679439603"><span class="hs-identifier">bsL</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679439604"><a href="#local-6989586621679439604"><span class="hs-identifier">bsR</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#bernsteinCoefs"><span class="hs-identifier hs-var">bernsteinCoefs</span></a><span> </span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679439595"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679439602"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679439596"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-248"></a><span>            </span><a name="local-6989586621679439605"><a href="#local-6989586621679439605"><span class="hs-identifier">pm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="AERN2.Poly.Power.RootsIntVector.html#thd"><span class="hs-identifier hs-var">thd</span></a><span> </span><a href="#local-6989586621679439604"><span class="hs-identifier hs-var">bsR</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>          </span><span class="hs-keyword">in</span><span>
</span><a name="line-250"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679439601"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-251"></a><span>              </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-252"></a><span>              </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439593"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">errorBound</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#Yes"><span class="hs-identifier hs-var">Yes</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-254"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439605"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439602"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679439602"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-255"></a><span>                </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439594"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679439602"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439603"><span class="hs-identifier hs-var">bsL</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#DontKnow"><span class="hs-identifier hs-var">DontKnow</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>                </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679439591"><span class="hs-identifier hs-var">splitUntilAccurate</span></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a href="#local-6989586621679439602"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679439595"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679439604"><span class="hs-identifier hs-var">bsR</span></a><span class="hs-special">,</span><span> </span><a href="AERN2.Poly.Power.RootsIntVector.html#DontKnow"><span class="hs-identifier hs-var">DontKnow</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>  </span><a name="local-6989586621679439592"><a href="#local-6989586621679439592"><span class="hs-identifier">intervalAccurate</span></a></a><span> </span><span class="hs-special">(</span><a href="AERN2.Interval.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a name="local-6989586621679439606"><a href="#local-6989586621679439606"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679439607"><a href="#local-6989586621679439607"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-258"></a><span>    </span><a href="#local-6989586621679439607"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439606"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0.5</span><span class="hs-operator hs-var">^!</span><span class="hs-special">(</span><span class="hs-identifier">fromAccuracy</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679439587"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">{-
findRoots :: PowPoly Integer -&gt; MPBall -&gt; MPBall -&gt; ((MPBall, MPBall) -&gt; Bool) -&gt; [(MPBall, MPBall)] -- TODO: if signVars == Nothing - recompute or give up? (currently giving up)
findRoots p l r intervalOK =      -- TODO: remove intervalOK and iterate until nix mehr geht
  splitUntilAccurate [(l, r, DontKnow, bsI)] []
  where
  lDown = rational $ dyadic (ball_value l) - dyadic (ball_error l)
  rUp   = rational $ dyadic (ball_value r) + dyadic (ball_error r)
  bsI = initialBernsteinCoefs p lDown rUp
  sgn x
   | x == 0 = 0
   | x &gt;  0 = 1
   | x &lt; 0  = -1
  splitUntilAccurate ::
    [(Rational, Rational, HasRoot, (Integer, Terms))]
    -&gt; [(Rational, Rational)]
    -&gt; [(Rational, Rational)]
  splitUntilAccurate [] res = res
  splitUntilAccurate ((a, b, hasRoot, (c, ts)) : is) res =
    let
      vars = signVars ts
    in
      maybeTrace (
      &quot;interval &quot; ++ (show (a, b)) ++ &quot;\n&quot; ++
       &quot;coefs: &quot; ++(show ts)++&quot;\n&quot;++
       &quot;vars: &quot;++(show vars)
      ) $
      if vars == 0 then
        splitUntilAccurate is res
      else if intervalOK (a, b) then
        splitUntilAccurate is ((a, b):res)
      else if hasRoot == Yes || vars == 1 then
        let
          m = 0.5*(a + b)
          sgnM     = sgn $ evalDirect p m  -- TODO: improve data structure to avoid redundant computations
          sgnLeft  = sgn $ evalDirect p a
          sgnRight = sgn $ evalDirect p b
        in
          maybeTrace (
           &quot;m: &quot;++ show m++&quot;\n&quot;++
           &quot;sgnM: &quot;++ show sgnM ++&quot;\n&quot;++
           &quot;value: &quot;++ show (evalDirect p m) ++&quot;\n&quot;++
           &quot;comparison: &quot;++ show (evalDirect p m == 0)
          ) $
          if (evalDirect p m == 0) == Just True then
            splitUntilAccurate is ((m,m):res)
          else if isJust sgnM &amp;&amp; isJust sgnLeft &amp;&amp; isJust sgnRight then
            if sgnLeft /= sgnM then
              splitUntilAccurate ((a, m, Yes, ts):is) res
            else
              splitUntilAccurate ((m, b, Yes, ts):is) res
          else
            splitUntilAccurate is ((a,b):res)
      else
        let
          findM cm =
            let
              sgnM = sgn $ evalDirect p cm
            in
              if isJust sgnM
                &amp;&amp; fromJust sgnM /= 0
              then
                cm
              else
                findM $ 0.5*(cm + b) -- TODO: find a better perturbation function
          m = findM $ 0.5*(a + b)
          (bsL, bsR)  = bernsteinCoefs a b m ts
        in
          splitUntilAccurate
            ((a,m, DontKnow, bsL) : (m,b, DontKnow, bsR) : is) res-}</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">{- auxiliary functions -}</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-identifier">binom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-334"></a><a name="binom"><a href="AERN2.Poly.Power.RootsIntVector.html#binom"><span class="hs-identifier">binom</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-335"></a><span class="hs-identifier">binom</span><span> </span><a name="local-6989586621679439608"><a href="#local-6989586621679439608"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679439609"><a href="#local-6989586621679439609"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="AERN2.Poly.Power.RootsIntVector.html#binom"><span class="hs-identifier hs-var">binom</span></a><span> </span><a href="#local-6989586621679439608"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439609"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439608"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679439609"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Prelude</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679439609"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-identifier">thd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679439503"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679439504"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621679439505"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679439505"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-338"></a><a name="thd"><a href="AERN2.Poly.Power.RootsIntVector.html#thd"><span class="hs-identifier">thd</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679439610"><a href="#local-6989586621679439610"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679439610"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-339"></a></pre></body></html>